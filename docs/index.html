<html lang="en-us"><script src="https://pygame-web.github.io/archives/0.9/pythons.js" type=module id=site data-LINES=57 data-CONSOLE=25 data-python=python3.12 data-os=vtx,fs,snd,gui async defer>#<!--

print("""
Loading Birds & Planes
""")

WIDTH=800
HEIGHT=600

REFX = 1980
REFY = 1080

def u(real, ref, v):
    if abs(v)<0.9999999:
        result = int( (float(real)/100.0) * (v*1000))
        if v<0:
            return real-result
        return result
    return int( (real/ref) * v )

def ux(*argv):
    global WIDTH, REFX
    acc = 0
    for v in argv:
        acc += u(WIDTH, REFX, v)
    return acc

def uy(*argv):
    global HEIGHT, REFY
    acc = 0
    for v in argv:
        acc += u(HEIGHT, REFY, v)
    return acc

async def custom_site():
    import sys
    import asyncio
    import platform
    import json
    from pathlib import Path

    import embed

    platform.document.body.style.background = "#87CEEB"

    import pygame

    def compose():
        pygame.display.update()
        window.chromakey(None, *screen.get_colorkey(), 40)

    pygame.init()
    pygame.font.init()

    screen = pygame.display.set_mode([ux(.100),uy(.100)], pygame.SRCALPHA, 32)
    screen.set_colorkey( (0,0,0,0), pygame.RLEACCEL )
    screen.fill( (0,0,0,0) )

    compose()

    platform.window.transfer.hidden = true
    platform.window.canvas.style.visibility = "visible"

    apk = "birds&planes.apk"
    bundle = "birds&planes"

    appdir = Path(f"/data/data/{bundle}")
    appdir.mkdir()

    cfg = {
        "io": "url",
        "type":"mount",
        "mount" : {
            "point" : appdir.as_posix(),
            "path" : "/",
        },
        "path" : f"/ => {appdir.as_posix()}",
    }

    track = platform.window.MM.prepare(apk, json.dumps(cfg))

    marginx = ux(.020)
    marginy = uy(.045)

    def pg_bar(pos):
        nonlocal marginx, marginy
        total = track.len or 10
        slot = ux(.060)/ total

        pygame.draw.rect(screen,(10,10,10),( marginx-ux(10), marginy-uy(10), (total*slot)+ux(20), uy(110) ) )
        pygame.draw.rect(screen,(0,255,0), ( marginx, marginy, track.pos*slot, uy(90)) )

    while not track.ready:
        pg_bar(track.pos)
        compose()
        await asyncio.sleep(.1)

    pg_bar(track.len)
    compose()

    platform.run_main(PyConfig, loaderhome= appdir / "assets", loadermain=None)

    while embed.counter()<0:
        await asyncio.sleep(.1)

    main = appdir / "assets" / "main.py"

    await TopLevel_async_handler.start_toplevel(platform.shell, console=window.python.config.debug)

    __import__(__name__).__file__ = str(main)

    fnt = pygame.sysfont.SysFont("freesans",  uy(80) )

    def ui_callback(pkg, error=None):
        nonlocal fnt
        if error:
            prompt = fnt.render(f"{error}", True, "black")
        else:
            prompt = fnt.render(f"Setting [{pkg}] up", True, "black")
        pg_bar(track.len)
        screen.blit(prompt, ( marginx+ ux(80), marginy - uy(10) ) )
        compose()

    if not platform.window.MM.UME:
        fnt = pygame.sysfont.SysFont("freesans",  uy(80) )
        prompt = fnt.render("TOCA PARA JUGAR", True, "blue")
        pg_bar(track.len)
        screen.blit(prompt, ( marginx+ ux(40), marginy - uy(10) ) )
        compose()
        print("Waiting for touch...")
        while not platform.window.MM.UME:
            await asyncio.sleep(.1)

    screen.fill( (0,0,0,0) )
    pygame.display.flip()

    await shell.runpy(main, callback=ui_callback)

import asyncio
asyncio.run( custom_site() )

# --></script><head><!--
--><script type="application/javascript">

config = {
    xtermjs : "1" ,
    _sdl2 : "canvas",
    user_canvas : 0,
    user_canvas_managed : 0,
    ume_block : 1,
    can_close : 0,
    archive : "birds&planes",
    gui_debug : 3,
    cdn : "https://pygame-web.github.io/archives/0.9/",
    autorun : 0,
    PYBUILD : "3.12"
}

</script>

    <title>Birds & Planes - Juego</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#87CEEB">
    
    <link rel="prefetch" href="https://pygame-web.github.io/archives/0.9/pythonrc.py">
    <link rel="prefetch" href="https://pygame-web.github.io/archives/0.9/vt/xterm.js">
    <link rel="icon" type="image/png" href="favicon.png" sizes="16x16">

    <style>
        * {
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        #status {
            display: inline-block;
            vertical-align: top;
            margin-top: 20px;
            margin-left: 30px;
            font-weight: bold;
            color: rgb(120, 120, 120);
        }

        #progress {
            height: 20px;
            width: 300px;
        }

        div.emscripten { text-align: center; }

        canvas.emscripten {
            border: 0px none;
            background-color: transparent;
            width: 100%;
            height: 100%;
            z-index: 5;
            padding: 0;
            margin: 0 auto;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            touch-action: none;
        }

        body {
            font-family: arial;
            margin: 0;
            padding: 0;
            background-color: #87CEEB;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        #startOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            cursor: pointer;
        }

        #startButton {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            font-size: 28px;
            font-weight: bold;
            padding: 30px 60px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            animation: pulse 1.5s infinite;
        }

        #startButton:active {
            transform: scale(0.95);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        #gameTitle {
            color: #FFD700;
            font-size: 36px;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        #loadingText {
            color: white;
            margin-top: 20px;
            font-size: 16px;
        }

        .bottomright { display: none; }
        #pyconsole { display: none; }
        #crt { display: none; }
    </style>

    <script src="https://pygame-web.github.io/archives/0.9//browserfs.min.js"></script>

</head>

<body>

    <div id="startOverlay">
        <div id="gameTitle">üê¶ BIRDS & PLANES ‚úàÔ∏è</div>
        <button id="startButton" onclick="startGame()">‚ñ∂ TOCA PARA JUGAR</button>
        <div id="loadingText">Cargando juego...</div>
    </div>

    <div id="transfer" align=center hidden>
        <div class="emscripten" id="status">Downloading...</div>
        <div class="emscripten">
            <progress value="0" max="100" id="progress"></progress>
        </div>
    </div>

    <canvas class="emscripten" id="canvas"
        width="1px"
        height="1px"
        oncontextmenu="event.preventDefault()" tabindex=1>
    </canvas>

    <div id=html></div>

    <div id=crt class=bottomright hidden>
        <div id="system" hidden></div>
        <div id=box class="emscripten_border" hidden=true>
            <div id="info" class="trinfo"></div>
        </div>
    </div>

    <div id="dlg" hidden>
        <input type="file" id="dlg_multifile" multiple accept="image/*">
    </div>

    <div id="pyconsole" hidden>
        <div id="terminal" tabIndex=1 align="left"></div>
    </div>

    <script type="application/javascript">
    
    let gameStarted = false;
    
    function startGame() {
        if (gameStarted) return;
        gameStarted = true;
        
        document.getElementById('startOverlay').style.display = 'none';
        
        // Trigger user media engagement
        if (window.MM && window.MM.UME !== undefined) {
            window.MM.UME = true;
        }
        
        // Focus canvas
        document.getElementById('canvas').focus();
        
        // Simulate click for audio context
        let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        audioCtx.resume();
    }

    // Also start on any touch/click on the page
    document.addEventListener('touchstart', function(e) {
        if (!gameStarted) {
            startGame();
        }
    }, { passive: true });

    document.addEventListener('click', function(e) {
        if (!gameStarted) {
            startGame();
        }
    });

    async function custom_onload(debug_hidden) {
        console.log("Game loading...");
        pyconsole.hidden = true;
        if (document.getElementById('system')) document.getElementById('system').hidden = true;
        transfer.hidden = true;
        if (document.getElementById('box')) document.getElementById('box').hidden = true;
    }

    function custom_prerun(){
        console.log("Prerun...");
    }

    function custom_postrun(){
        console.log("Postrun...");
        window.addEventListener("keydown", function(e) {
            if(["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) {
                e.preventDefault();
            }
        }, false);
        
        // Hide loading text when ready
        let loadingText = document.getElementById('loadingText');
        if (loadingText) {
            loadingText.textContent = '¬°Listo para jugar!';
        }
    }

    </script>

</body>
</html>
